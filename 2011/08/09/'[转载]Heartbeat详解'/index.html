<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>[转载]Heartbeat详解  | Elain&#39;blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="配置主节点的Heartbeat&amp;nbsp;Heartbeat的主要配置文件有ha.cf、haresources和authkeys。在Heartbeat安装后，默认并没有这3个文件， 可以从官方网站下载得到，也可以直接从解压的源码目录中找到。在上面的安装过程中，我们已经将这3个文件放到了/etc/ha.d目录下，下面分别详细介 绍。1．主配置文件（/etc/ha.d/ha.cf）下面对ha.cf文件">
<meta property="og:type" content="article">
<meta property="og:title" content="[转载]Heartbeat详解 ">
<meta property="og:url" content="http://www.elain.org/2011/08/09/'[转载]Heartbeat详解'/index.html">
<meta property="og:site_name" content="Elain'blog">
<meta property="og:description" content="配置主节点的Heartbeat&amp;nbsp;Heartbeat的主要配置文件有ha.cf、haresources和authkeys。在Heartbeat安装后，默认并没有这3个文件， 可以从官方网站下载得到，也可以直接从解压的源码目录中找到。在上面的安装过程中，我们已经将这3个文件放到了/etc/ha.d目录下，下面分别详细介 绍。1．主配置文件（/etc/ha.d/ha.cf）下面对ha.cf文件">
<meta property="og:updated_time" content="2016-02-02T06:18:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[转载]Heartbeat详解 ">
<meta name="twitter:description" content="配置主节点的Heartbeat&amp;nbsp;Heartbeat的主要配置文件有ha.cf、haresources和authkeys。在Heartbeat安装后，默认并没有这3个文件， 可以从官方网站下载得到，也可以直接从解压的源码目录中找到。在上面的安装过程中，我们已经将这3个文件放到了/etc/ha.d目录下，下面分别详细介 绍。1．主配置文件（/etc/ha.d/ha.cf）下面对ha.cf文件">
  
    <link rel="alternative" href="/atom.xml" title="Elain&#39;blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: true
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/avatar.png" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">elain</a></h1>
        </hgroup>

        
        <p class="header-subtitle">致力于LINUX技术研究交流!开源一切,免费一切!!!</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:elain2012@hotmail.com" title="Email"></a></li>
                            
                                <li id="新浪微博"><a class="新浪微博" target="_blank" href="/elain2012" title="新浪微博"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/IT，健康/" style="font-size: 10px;">IT，健康</a> <a href="/tags/LINUX/" style="font-size: 18.89px;">LINUX</a> <a href="/tags/PXE/" style="font-size: 10px;">PXE</a> <a href="/tags/RHEL/" style="font-size: 10px;">RHEL</a> <a href="/tags/access/" style="font-size: 10px;">access</a> <a href="/tags/apache/" style="font-size: 15.56px;">apache</a> <a href="/tags/arping/" style="font-size: 10px;">arping</a> <a href="/tags/awstats/" style="font-size: 10px;">awstats</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bashrc/" style="font-size: 11.11px;">bashrc</a> <a href="/tags/cacti/" style="font-size: 12.22px;">cacti</a> <a href="/tags/centos/" style="font-size: 12.22px;">centos</a> <a href="/tags/chattr/" style="font-size: 10px;">chattr</a> <a href="/tags/chkconfig/" style="font-size: 10px;">chkconfig</a> <a href="/tags/chmod/" style="font-size: 10px;">chmod</a> <a href="/tags/chroot/" style="font-size: 10px;">chroot</a> <a href="/tags/cobbler/" style="font-size: 10px;">cobbler</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/crontab/" style="font-size: 10px;">crontab</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/cwrsync/" style="font-size: 10px;">cwrsync</a> <a href="/tags/date/" style="font-size: 10px;">date</a> <a href="/tags/ddos/" style="font-size: 10px;">ddos</a> <a href="/tags/drbd/" style="font-size: 10px;">drbd</a> <a href="/tags/eaccelerator/" style="font-size: 10px;">eaccelerator</a> <a href="/tags/earth/" style="font-size: 10px;">earth</a> <a href="/tags/efk/" style="font-size: 12.22px;">efk</a> <a href="/tags/elasticsearch/" style="font-size: 14.44px;">elasticsearch</a> <a href="/tags/elk/" style="font-size: 11.11px;">elk</a> <a href="/tags/es/" style="font-size: 11.11px;">es</a> <a href="/tags/etc/" style="font-size: 10px;">etc</a> <a href="/tags/facebook/" style="font-size: 11.11px;">facebook</a> <a href="/tags/fetion/" style="font-size: 11.11px;">fetion</a> <a href="/tags/find/" style="font-size: 10px;">find</a> <a href="/tags/firefox/" style="font-size: 11.11px;">firefox</a> <a href="/tags/fluentd/" style="font-size: 12.22px;">fluentd</a> <a href="/tags/free/" style="font-size: 10px;">free</a> <a href="/tags/fstab/" style="font-size: 10px;">fstab</a> <a href="/tags/ganglia/" style="font-size: 10px;">ganglia</a> <a href="/tags/geany/" style="font-size: 10px;">geany</a> <a href="/tags/gedit/" style="font-size: 11.11px;">gedit</a> <a href="/tags/getots/" style="font-size: 10px;">getots</a> <a href="/tags/gnome/" style="font-size: 10px;">gnome</a> <a href="/tags/gnome-player/" style="font-size: 10px;">gnome player</a> <a href="/tags/graphicsmagick/" style="font-size: 10px;">graphicsmagick</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/gstm/" style="font-size: 10px;">gstm</a> <a href="/tags/ha/" style="font-size: 11.11px;">ha</a> <a href="/tags/hadoop/" style="font-size: 11.11px;">hadoop</a> <a href="/tags/heartbeat/" style="font-size: 11.11px;">heartbeat</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/httpd/" style="font-size: 11.11px;">httpd</a> <a href="/tags/imagemagick/" style="font-size: 10px;">imagemagick</a> <a href="/tags/inittab/" style="font-size: 10px;">inittab</a> <a href="/tags/innodb/" style="font-size: 10px;">innodb</a> <a href="/tags/iostat/" style="font-size: 13.33px;">iostat</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/ipv6/" style="font-size: 10px;">ipv6</a> <a href="/tags/it/" style="font-size: 10px;">it</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/keepalived/" style="font-size: 11.11px;">keepalived</a> <a href="/tags/kibana/" style="font-size: 12.22px;">kibana</a> <a href="/tags/kibana4/" style="font-size: 10px;">kibana4</a> <a href="/tags/kickstart/" style="font-size: 11.11px;">kickstart</a> <a href="/tags/lamp/" style="font-size: 12.22px;">lamp</a> <a href="/tags/last/" style="font-size: 10px;">last</a> <a href="/tags/lemp/" style="font-size: 11.11px;">lemp</a> <a href="/tags/lnmp/" style="font-size: 10px;">lnmp</a> <a href="/tags/log/" style="font-size: 11.11px;">log</a> <a href="/tags/logrotate/" style="font-size: 10px;">logrotate</a> <a href="/tags/logstash/" style="font-size: 10px;">logstash</a> <a href="/tags/lvs/" style="font-size: 13.33px;">lvs</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/memcache/" style="font-size: 10px;">memcache</a> <a href="/tags/memcached/" style="font-size: 10px;">memcached</a> <a href="/tags/michael-jackson/" style="font-size: 10px;">michael jackson</a> <a href="/tags/mongodb/" style="font-size: 14.44px;">mongodb</a> <a href="/tags/moosefs/" style="font-size: 10px;">moosefs</a> <a href="/tags/mpstat/" style="font-size: 12.22px;">mpstat</a> <a href="/tags/myisam/" style="font-size: 10px;">myisam</a> <a href="/tags/mysql/" style="font-size: 18.89px;">mysql</a> <a href="/tags/nagios/" style="font-size: 14.44px;">nagios</a> <a href="/tags/nc/" style="font-size: 10px;">nc</a> <a href="/tags/nfs/" style="font-size: 10px;">nfs</a> <a href="/tags/nginx/" style="font-size: 16.67px;">nginx</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/nrpe/" style="font-size: 10px;">nrpe</a> <a href="/tags/openfetion/" style="font-size: 10px;">openfetion</a> <a href="/tags/openssh/" style="font-size: 10px;">openssh</a> <a href="/tags/pagespeed/" style="font-size: 10px;">pagespeed</a> <a href="/tags/parted/" style="font-size: 10px;">parted</a> <a href="/tags/passwd/" style="font-size: 11.11px;">passwd</a> <a href="/tags/php/" style="font-size: 15.56px;">php</a> <a href="/tags/phpmyadmin/" style="font-size: 10px;">phpmyadmin</a> <a href="/tags/piranha/" style="font-size: 10px;">piranha</a> <a href="/tags/pop3/" style="font-size: 10px;">pop3</a> <a href="/tags/pptpd/" style="font-size: 10px;">pptpd</a> <a href="/tags/prework/" style="font-size: 10px;">prework</a> <a href="/tags/psmouse/" style="font-size: 10px;">psmouse</a> <a href="/tags/puppet/" style="font-size: 13.33px;">puppet</a> <a href="/tags/qq/" style="font-size: 10px;">qq</a> <a href="/tags/rabbitvcs/" style="font-size: 10px;">rabbitvcs</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/root/" style="font-size: 10px;">root</a> <a href="/tags/rrdtool/" style="font-size: 10px;">rrdtool</a> <a href="/tags/rsync/" style="font-size: 13.33px;">rsync</a> <a href="/tags/rsyslog/" style="font-size: 11.11px;">rsyslog</a> <a href="/tags/sar/" style="font-size: 11.11px;">sar</a> <a href="/tags/screen/" style="font-size: 10px;">screen</a> <a href="/tags/search-guard/" style="font-size: 10px;">search-guard</a> <a href="/tags/sersync/" style="font-size: 10px;">sersync</a> <a href="/tags/shadow/" style="font-size: 11.11px;">shadow</a> <a href="/tags/shell/" style="font-size: 17.78px;">shell</a> <a href="/tags/showslow/" style="font-size: 10px;">showslow</a> <a href="/tags/slave/" style="font-size: 10px;">slave</a> <a href="/tags/smtp/" style="font-size: 10px;">smtp</a> <a href="/tags/snort/" style="font-size: 10px;">snort</a> <a href="/tags/sort/" style="font-size: 10px;">sort</a> <a href="/tags/ssh/" style="font-size: 13.33px;">ssh</a> <a href="/tags/subversion/" style="font-size: 11.11px;">subversion</a> <a href="/tags/svn/" style="font-size: 13.33px;">svn</a> <a href="/tags/tar/" style="font-size: 10px;">tar</a> <a href="/tags/td-agent/" style="font-size: 10px;">td-agent</a> <a href="/tags/tetngine/" style="font-size: 10px;">tetngine</a> <a href="/tags/thunderbird/" style="font-size: 11.11px;">thunderbird</a> <a href="/tags/tomcat/" style="font-size: 11.11px;">tomcat</a> <a href="/tags/tomcat，多实例/" style="font-size: 10px;">tomcat，多实例</a> <a href="/tags/top/" style="font-size: 11.11px;">top</a> <a href="/tags/ubuntu/" style="font-size: 20px;">ubuntu</a> <a href="/tags/ubunut/" style="font-size: 10px;">ubunut</a> <a href="/tags/unity/" style="font-size: 10px;">unity</a> <a href="/tags/varnish/" style="font-size: 11.11px;">varnish</a> <a href="/tags/vbox/" style="font-size: 10px;">vbox</a> <a href="/tags/vi/" style="font-size: 11.11px;">vi</a> <a href="/tags/vim/" style="font-size: 13.33px;">vim</a> <a href="/tags/vmstat/" style="font-size: 12.22px;">vmstat</a> <a href="/tags/vsftpd/" style="font-size: 10px;">vsftpd</a> <a href="/tags/web/" style="font-size: 16.67px;">web</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/wine/" style="font-size: 10px;">wine</a> <a href="/tags/worker/" style="font-size: 10px;">worker</a> <a href="/tags/xhprof/" style="font-size: 10px;">xhprof</a> <a href="/tags/yakuake/" style="font-size: 10px;">yakuake</a> <a href="/tags/yslow/" style="font-size: 10px;">yslow</a> <a href="/tags/yum/" style="font-size: 12.22px;">yum</a> <a href="/tags/zend/" style="font-size: 10px;">zend</a> <a href="/tags/主从同步/" style="font-size: 10px;">主从同步</a> <a href="/tags/休息/" style="font-size: 10px;">休息</a> <a href="/tags/内核/" style="font-size: 10px;">内核</a> <a href="/tags/字体/" style="font-size: 10px;">字体</a> <a href="/tags/学习资料/" style="font-size: 10px;">学习资料</a> <a href="/tags/心情/" style="font-size: 10px;">心情</a> <a href="/tags/敏捷/" style="font-size: 10px;">敏捷</a> <a href="/tags/日志/" style="font-size: 10px;">日志</a> <a href="/tags/时间/" style="font-size: 10px;">时间</a> <a href="/tags/漏洞/" style="font-size: 10px;">漏洞</a> <a href="/tags/翻墙/" style="font-size: 11.11px;">翻墙</a> <a href="/tags/职业规划，规划，职业/" style="font-size: 11.11px;">职业规划，规划，职业</a> <a href="/tags/面板/" style="font-size: 10px;">面板</a> <a href="/tags/颜色/" style="font-size: 10px;">颜色</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">elain</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/avatar.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">elain</a></h1>
            </hgroup>
            
            <p class="header-subtitle">致力于LINUX技术研究交流!开源一切,免费一切!!!</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:elain2012@hotmail.com" title="Email"></a></li>
                            
                                <li id="新浪微博"><a class="新浪微博" target="_blank" href="/elain2012" title="新浪微博"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-&#39;[转载]Heartbeat详解&#39;" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2011/08/09/'[转载]Heartbeat详解'/" class="article-date">
      <time datetime="2011-08-09T03:08:40.000Z" itemprop="datePublished">2011-08-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      [转载]Heartbeat详解 
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/负载均衡/">负载均衡</a><a class="article-category-link" href="/categories/负载均衡/高可用/">高可用</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ha/">ha</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/heartbeat/">heartbeat</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <div align="left"><strong>配置主节点的Heartbeat</strong><br><br>&nbsp;<br><br>Heartbeat的主要配置文件有ha.cf、haresources和authkeys。在Heartbeat安装后，默认并没有这3个文件， 可以从官方网站下载得到，也可以直接从解压的源码目录中找到。在上面的安装过程中，我们已经将这3个文件放到了/etc/ha.d目录下，下面分别详细介 绍。<br><br><strong>1．主配置文件（/etc/ha.d/ha.cf）</strong><br><br>下面对ha.cf文件的每个选项进行详细介绍，其中&quot;#&quot;号后面的内容是对选项的注释说明。<br><br>1.  <span><span>#debugfile&nbsp;/var/log/ha-debug &nbsp;</span></span><br>2.  <span>logfile&nbsp;/var/log/ha-log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#指名heartbeat的日志存放位置。 &nbsp;</span><br>3.  <span>#crm&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#是否开启Cluster&nbsp;Resource&nbsp;Manager（集群资源管理）功能。 &nbsp;</span><br>4.  <span>bcast&nbsp;eth1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#指明心跳使用以太网广播方式，并且是在eth1接口上进行广播。 &nbsp;</span><br>5.  <span>keepalive&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#指定心跳间隔时间为2秒（即每2秒钟在eth1上发送一次广播）。 &nbsp;</span><br>6.  <span>deadtime&nbsp;30&nbsp;#指定若备用节点在30秒内没有收到主节点的心跳信号，则立即接管主节点的服务资源。 &nbsp;</span><br>7.  <span>warntime&nbsp;10&nbsp;#指定心跳延迟的时间为10秒。当10秒钟内备份节点不能接收到主节点的 心跳信号时，就会往日志中写入一个警告日志，但此时不会切换服务。 &nbsp;</span><br>8.  <span>initdead&nbsp;120&nbsp;&nbsp;&nbsp;&nbsp;#在某些系统上，系统启动或重启之后需要经过一段时间网络才 能正常工作，该选项用于解决这种情况产生的时间间隔。取值至少为deadtime的两倍。 &nbsp;</span><br>9.  <span>udpport&nbsp;694&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#设置广播通信使用的端口，694为默认使用的端口号。 &nbsp;</span><br>10.  <span>baud&nbsp;19200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#设置串行通信的波特率。 &nbsp;</span><br>11.  <span>#serial&nbsp;/dev/ttyS0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#选择串行通信设备，用于双机使用串口线连接的情况。 如果双机使用以太网连接，则应该关闭该选项。 &nbsp;</span><br>12.  <span>#ucast&nbsp;eth0&nbsp;192.168.1.2&nbsp;#采用网卡eth0的udp单播来组织心跳，后面跟的 IP地址应为双机对方的IP地址。 &nbsp;</span><br>13.  <span>#mcast&nbsp;eth0&nbsp;225.0.0.1&nbsp;694&nbsp;1&nbsp;0&nbsp;&nbsp;&nbsp;#采用网卡eth0的Udp多播来组织心跳， 一般在备用节点不止一台时使用。Bcast、ucast和mcast分别代表广播、单播 和多播，是组织心跳的三种方式，任选其一即可。 &nbsp;</span><br>14.  <span>auto_failback&nbsp;on&nbsp;&nbsp;&nbsp;&nbsp;#用来定义当主节点恢复后，是否将服务自动切回。 heartbeat的两台主机分别为主节点和备份节点。主节点在正常情况下占用资源 并运行所有的服务，遇到故障时把资源交给备份节点并由备份节点运行服务。在该 选项设为on的情况下，一旦主节点恢复运行，则自动获取资源并取代备份节点； 如果该选项设置为off，那么当主节点恢复后，将变为备份节点，而原来的备份节点成为主节点。 &nbsp;</span><br>15.  <span>#stonith&nbsp;baytech&nbsp;/etc/ha.d/conf/stonith.baytech&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;stonith的主 要作用是使出现问题的节点从集群环境中脱离，进而释放集群资源，避免两个节点争 用一个资源的情形发生。保证共享数据的安全性和完整性。 &nbsp;</span><br>16.  <span>#watchdog&nbsp;/dev/watchdog&nbsp;#该选项是可选配置，是通过Heartbeat来监控系统的运 行状态。使用该特性，需要在内核中载入&quot;softdog&quot;内核模块，用来生成实际的设备文件， 如果系统中没有这个内核模块，就需要指定此模块，重新编译内核。编译完成输入 &quot;insmod&nbsp;softdog&quot;加载该模块。然后输入&quot;grep&nbsp;misc&nbsp;/proc/devices&quot;(应为10)， 输入&quot;cat&nbsp;/proc/misc&nbsp;|grep&nbsp;watchdog&quot;(应为130)。最后，生成设备文件： &quot;mknod&nbsp;/dev/watchdog&nbsp;c&nbsp;10&nbsp;130&quot;&nbsp;。即可使用此功能。 &nbsp;</span><br>17.  <span>node&nbsp;node1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#主节点主机名，可以通过命令&quot;uanme&nbsp;-n&quot;查看。 &nbsp;</span><br>18.  <span>node&nbsp;node2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#备用节点主机名。 &nbsp;</span><br>19.  <span>ping&nbsp;192.168.60.1&nbsp;&nbsp;&nbsp;#选择ping的节点，ping节点选择的越好，HA集群就越强壮， 可以选择固定的路由器作为ping节点，但是最好不要选择集群中的成员作为ping节点， ping节点仅仅用来测试网络连接。 &nbsp;</span><br>20.  <span>respawn&nbsp;hacluster&nbsp;/usr/lib/heartbeat/ipfail&nbsp;#该选项是可选配置，列出与 heartbeat一起启动和关闭的进程，该进程一般是和heartbeat集成的插件，这些进程 遇到故障可以自动重新启动。最常用的进程是ipfail，此进程用于检测和处理网络故障， 需要配合ping语句指定的ping&nbsp;node来检测网络的连通性。其中hacluster表示启动ipfail进程的身份。&nbsp;</span><br><br><a id="more"></a><br><br><font face="Courier New"><strong>2．资源文件（/etc/ha.d/haresources）</strong></font><br><br><font face="Courier New">Haresources文件用于指定双机系统的主节点、集群IP、子网掩码、广播地址以及启动的服务等集群资源，文件每一行可以包含一个或多个资源脚本名，资源之间使用空格隔开，参数之间使用两个冒号隔开，在两个HA节点上该文件必须完全一致，此文件的一般格式为：</font><br><br>1.  <span><span>node-name&nbsp;network&nbsp;&nbsp;</span><strong><font color="#006699"><span class="tag">&lt;</span><span class="tag-name">resource-group</span><span class="tag">&gt;</span></font></strong><span>&nbsp;</span></span><br><br>node-name表示主节点的主机名，必须和ha.cf文件中指定的节点名一致。network用于设定集群的IP地址、子网掩码和网络设备标识 等。需要注意的是，这里指定的IP地址就是集群对外服务的IP地址，resource-group用来指定需要Heartbeat托管的服务，也就是这些 服务可以由Heartbeat来启动和关闭。如果要托管这些服务，就必须将服务写成可以通过start/stop来启动和关闭的脚步，然后放到/etc /init.d/或者/etc/ha.d/resource.d/目录下，Heartbeat会根据脚本的名称自动去/etc/init.d或者/etc /ha.d/resource.d/目录下找到相应脚步进行启动或关闭操作。<br><br>下面对配置方法进行具体说明：<br><br>1.  <span><span>node1&nbsp;IPaddr::192.168.60.200/24/eth0/&nbsp;&nbsp;Filesystem:: /dev/sdb5::/webdata::ext3&nbsp;&nbsp;httpd&nbsp;tomcat&nbsp;</span></span><br><br><font face="Courier New">其中，node1是HA集群的主节点，IPaddr为heartbeat自带的一个执行脚 步，Heartbeat首先将执行/etc/ha.d/resource.d/IPaddr 192.168.60.200/24 start的操作，也就是虚拟出一个子网掩码为255.255.255.0，IP为192.168.60.200的地址。此IP为Heartbeat对外 提供服务的网络地址，同时指定此IP使用的网络接口为eth0。接着，Heartbeat将执行共享磁盘分区的挂载操 作，&quot;Filesystem::/dev/sdb5::/webdata::ext3&quot;相当于在命令行下执行mount操作，即&quot;mount -t ext3 /dev/sdb5 /webdata&quot;，最后依次启动httpd和Tomcat服务。</font><br><br><font face="Courier New">注意&nbsp;主节点和备份节点中资源文件haresources要完全一样。</font><br><br><font face="Courier New"><strong>3．认证文件（/etc/ha.d/authkeys）</strong></font><br><br><font face="Courier New">authkeys文件用于设定Heartbeat的认证方式，共有3种可用的认证方式，即 crc、md5和sha1。3种认证方式的安全性依次提高，但是占用的系统资源也依次增加。如果Heartbeat集群运行在安全的网络上，可以使用 crc方式；如果HA每个节点的硬件配置很高，建议使用sha1，这种认证方式安全级别最高；如果是处于网络安全和系统资源之间，可以使用md5认证方 式。这里我们使用crc认证方式，设置如下：</font><br><br>1.  <span><span>auth&nbsp;1 &nbsp;</span></span><br>2.  <span>1&nbsp;crc &nbsp;</span><br>3.  <span>#2&nbsp;sha1&nbsp;sha1_any_password &nbsp;</span><br>4.  <span>#3&nbsp;md5&nbsp;md5_any_password&nbsp;</span><br><br>需要说明的一点是：无论auth后面指定的是什么数字，在下一行必须作为关键字再次出现，例如指定了&quot;auth 6&quot;，下面一定要有一行&quot;6 认证类型&quot;。<br><br>最后确保这个文件的权限是600（即-rw——-）。<br><br><strong>配置备份节点的Heartbeat</strong><br><br>在备份节点上也需要安装Heartbeat，安装方式与在主节点安装过程一样，这里不再重述。依次安装libnet和heartbeat源码包，安装完毕，在备份节点上使用scp命令把主节点配置文件传输到备份节点。<br><br>1.  <span><span>[root@node2&nbsp;~]#scp&nbsp;-r&nbsp;node1:/etc/ha.d/<em>&nbsp;&nbsp;/etc/ha.d/&nbsp;</em></span></span><br><br>其中，node1是主节点的主机名<br><br><strong>设置主节点和备份节点时间同步</strong><br><br>在双机高可用集群中，主节点和备份节点的系统时间也非常重要，因为节点之间的监控都是通过设定时间来实现的。主备节点之间的系统时间相差在10秒以 内是正常的，如果节点之间时间相差太大，就有可能造成HA环境的故障。解决时间同步的办法有两个：一个办法是找一个时间服务器，两个节点通过 ntpdate命令定时与时间服务器进行时间校准；另一个办法是让集群中的主节点作为ntp时间服务器，让备份节点定时去主节点进行时间校验。<br><br><strong>启动Heartbeat</strong><br><br><strong>1．启动主节点的Heartbeat</strong><br><br>Heartbeat安装完成后，自动在/etc/init.d目录下生成了启动脚步文件Heartbeat，直接输入/etc/init.d/heartbeat可以看到Heartbeat脚本的用法，如下所示：<br><br>1.  <span><span>[root@node1&nbsp;~]#&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp; &nbsp;</span></span><br>2.  <span>Usage:&nbsp;/etc/init.d/heartbeat&nbsp;{start|stop|status|restart|reload|force-reload}&nbsp;</span><br><br>因而启动Heartbeat可以通过如下命令进行：<br><br>1.  <span><span>[root@node1&nbsp;~]#service&nbsp;heartbeat&nbsp;start&nbsp;</span></span><br><br>或者通过：<br><br>1.  <span><span>[root@node1&nbsp;~]#/etc/init.d/heartbeat&nbsp;start&nbsp;</span></span><br><br>这样就启动了主节点的Heartbeat服务，为了让Heartbeat能在开机自动运行以及关机自动关闭，可以手动创建以下软连接：<br><br>1.  <span><span>[root@node1&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc0.d/K05heartbeat &nbsp;</span></span><br>2.  <span>[root@node1&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc3.d/S75heartbeat &nbsp;</span><br>3.  <span>[root@node1&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc5.d/S75heartbeat &nbsp;</span><br>4.  <span>[root@node1&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc6.d/K05heartbeat&nbsp;</span><br><br>Heartbeat启动时，通过&quot;tail -f /var/log/ messages&quot;查看主节点系统日志信息，输出如下：<br><br>1.  <span><span>[root@node1&nbsp;~]#&nbsp;tail&nbsp;-f&nbsp;/var/log/messages &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3688]:&nbsp;info: Configuration&nbsp;validated.&nbsp;Starting&nbsp;heartbeat&nbsp;2.0.8 &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; heartbeat:&nbsp;version&nbsp;2.0.8 &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Heartbeat&nbsp;generation:&nbsp;3 &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; G_main_add_TriggerHandler:&nbsp;Added&nbsp;signal&nbsp;manual&nbsp;handler &nbsp;</span><br>6.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; G_main_add_TriggerHandler:&nbsp;Added&nbsp;signal&nbsp;manual&nbsp;handler &nbsp;</span><br>7.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; glib:&nbsp;UDP&nbsp;Broadcast&nbsp;heartbeat&nbsp;started&nbsp;on&nbsp;port&nbsp;694&nbsp;(694)&nbsp;interface&nbsp;eth1 &nbsp;</span><br>8.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info: glib:&nbsp;UDP&nbsp;Broadcast&nbsp;heartbeat&nbsp;closed&nbsp;on&nbsp;port&nbsp;694&nbsp;interface&nbsp;eth1&nbsp;-&nbsp;Status:&nbsp;1 &nbsp;</span><br>9.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; glib:&nbsp;ping&nbsp;heartbeat&nbsp;started. &nbsp;</span><br>10.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; G_main_add_SignalHandler:&nbsp;Added&nbsp;signal&nbsp;handler&nbsp;for&nbsp;signal&nbsp;17 &nbsp;</span><br>11.  <span>Nov&nbsp;26&nbsp;07:52:21&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Local&nbsp;status&nbsp;now&nbsp;set&nbsp;to:&nbsp;&#039;up&#039; &nbsp;</span><br>12.  <span>Nov&nbsp;26&nbsp;07:52:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Link&nbsp;node1:eth1&nbsp;up. &nbsp;</span><br>13.  <span>Nov&nbsp;26&nbsp;07:52:23&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Link&nbsp;192.168.60.1:192.168.60.1&nbsp;up. &nbsp;</span><br>14.  <span>Nov&nbsp;26&nbsp;07:52:23&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Status&nbsp;update&nbsp;for&nbsp;node&nbsp;192.168.60.1:&nbsp;status&nbsp;ping&nbsp;</span><br><br>此段日志是Heartbeat在进行初始化配置，例如，Heartbeat的心跳时间间隔、UDP广播端口和ping节点的运行状态等，日志信息到 这里会暂停，等待120秒之后，Heartbeat会继续输出日志，而这个120秒刚好是ha.cf中&quot;initdead&quot;选项的设定时间。此时 Heartbeat的输出信息如下：<br><br>1.  <span><span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;WARN:&nbsp;node&nbsp;node2:&nbsp;is&nbsp;dead &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Comm_now_up():&nbsp;updating&nbsp;status&nbsp;to&nbsp;active &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Local&nbsp;status&nbsp;now&nbsp;set&nbsp;to:&nbsp;&#039;active&#039; &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info: Starting&nbsp;child&nbsp;client&nbsp;&quot;/usr/lib/heartbeat/ipfail&quot;&nbsp;(694,694) &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;WARN:&nbsp; No&nbsp;STONITH&nbsp;device&nbsp;configured. &nbsp;</span><br>6.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;WARN: Shared&nbsp;disks&nbsp;are&nbsp;not&nbsp;protected. &nbsp;</span><br>7.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Resources&nbsp;being&nbsp;acquired&nbsp;from&nbsp;node2. &nbsp;</span><br>8.  <span>Nov&nbsp;26&nbsp;07:54:22&nbsp;node1&nbsp;heartbeat:&nbsp;[3712]:&nbsp;info:&nbsp; Starting&nbsp;&quot;/usr/lib/heartbeat/ipfail&quot;&nbsp;as&nbsp;uid&nbsp;694&nbsp;&nbsp;gid&nbsp;694&nbsp;(pid&nbsp;3712)&nbsp;</span><br><br>在上面这段日志中，由于node2还没有启动，因此会给出&quot;node2: is dead&quot;的警告信息，接下来启动了Heartbeat插件ipfail。由于我们在ha.cf文件中没有配置STONITH，因此日志里也给出了&quot;No STONITH device configured&quot;的警告提示。<br><br>继续看下面的日志：<br><br>1.  <span><span>Nov&nbsp;26&nbsp;07:54:23&nbsp;node1&nbsp;harc[3713]:&nbsp;info:&nbsp;Running&nbsp;/etc/ha.d/rc.d/status&nbsp;status &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;07:54:23&nbsp;node1&nbsp;mach_down[3735]:&nbsp;info:&nbsp;/usr/lib/ heartbeat/mach_down:&nbsp;nice_failback:&nbsp;foreign&nbsp;resources&nbsp;acquired &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;07:54:23&nbsp;node1&nbsp;mach_down[3735]:&nbsp;info:&nbsp;mach_down&nbsp; takeover&nbsp;complete&nbsp;for&nbsp;node&nbsp;node2. &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;07:54:23&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp;mach_down&nbsp;takeover&nbsp;complete. &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;07:54:23&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp;Initial&nbsp; resource&nbsp;acquisition&nbsp;complete&nbsp;(mach_down) &nbsp;</span><br>6.  <span>Nov&nbsp;26&nbsp;07:54:24&nbsp;node1&nbsp;IPaddr[3768]:&nbsp;INFO:&nbsp;&nbsp;Resource&nbsp;is&nbsp;stopped &nbsp;</span><br>7.  <span>Nov&nbsp;26&nbsp;07:54:24&nbsp;node1&nbsp;heartbeat:&nbsp;[3714]:&nbsp;info:&nbsp;Local&nbsp;Resource&nbsp; acquisition&nbsp;completed. &nbsp;</span><br>8.  <span>Nov&nbsp;26&nbsp;07:54:24&nbsp;node1&nbsp;harc[3815]:&nbsp;info:&nbsp;Running&nbsp;/etc/ha. d/rc.d/ip-request-resp&nbsp;ip-request-resp &nbsp;</span><br>9.  <span>Nov&nbsp;26&nbsp;07:54:24&nbsp;node1&nbsp;ip-request-resp[3815]:&nbsp;received&nbsp;ip- request-resp&nbsp;192.168.60.200/24/eth0&nbsp;OK&nbsp;yes &nbsp;</span><br>10.  <span>Nov&nbsp;26&nbsp;07:54:24&nbsp;node1&nbsp;ResourceManager[3830]:&nbsp;info:&nbsp;Acquiring&nbsp; resource&nbsp;group:&nbsp;node1&nbsp;192.168.60.200/24/eth0&nbsp;Filesystem: :/dev/sdb5::/webdata::ext3 &nbsp;</span><br>11.  <span>Nov&nbsp;26&nbsp;07:54:24&nbsp;node1&nbsp;IPaddr[3854]:&nbsp;INFO:&nbsp;&nbsp;Resource&nbsp;is&nbsp;stopped &nbsp;</span><br>12.  <span>Nov&nbsp;26&nbsp;07:54:25&nbsp;node1&nbsp;ResourceManager[3830]:&nbsp;info:&nbsp;Running&nbsp; /etc/ha.d/resource.d/IPaddr&nbsp;192.168.60.200/24/eth0&nbsp;start &nbsp;</span><br>13.  <span>Nov&nbsp;26&nbsp;07:54:25&nbsp;node1&nbsp;IPaddr[3932]:&nbsp;INFO:&nbsp;Using&nbsp;calculated netmask&nbsp;for&nbsp;192.168.60.200:&nbsp;255.255.255.0 &nbsp;</span><br>14.  <span>Nov&nbsp;26&nbsp;07:54:25&nbsp;node1&nbsp;IPaddr[3932]:&nbsp;DEBUG:&nbsp;Using&nbsp;calculated&nbsp; broadcast&nbsp;for&nbsp;192.168.60.200:&nbsp;192.168.60.255 &nbsp;</span><br>15.  <span>Nov&nbsp;26&nbsp;07:54:25&nbsp;node1&nbsp;IPaddr[3932]:&nbsp;INFO:&nbsp;eval&nbsp;/sbin/ifconfig eth0:0&nbsp;192.168.60.200&nbsp;netmask&nbsp;255.255.255.0&nbsp;broadcast&nbsp;192.168.60.255 &nbsp;</span><br>16.  <span>Nov&nbsp;26&nbsp;07:54:25&nbsp;node1&nbsp;avahi-daemon[1854]:&nbsp;Registering&nbsp;new&nbsp; address&nbsp;record&nbsp;for&nbsp;192.168.60.200&nbsp;on&nbsp;eth0. &nbsp;</span><br>17.  <span>Nov&nbsp;26&nbsp;07:54:25&nbsp;node1&nbsp;IPaddr[3932]:&nbsp;DEBUG:&nbsp;Sending&nbsp;Gratuitous Arp&nbsp;for&nbsp;192.168.60.200&nbsp;on&nbsp;eth0:0&nbsp;[eth0] &nbsp;</span><br>18.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;IPaddr[3911]:&nbsp;INFO:&nbsp;&nbsp;Success &nbsp;</span><br>19.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;Filesystem[4021]:&nbsp;INFO:&nbsp;&nbsp;Resource&nbsp;is&nbsp;stopped &nbsp;</span><br>20.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;ResourceManager[3830]:&nbsp;info:&nbsp;Running&nbsp; /etc/ha.d/resource.d/&nbsp;Filesystem/dev/sdb5&nbsp;/webdata&nbsp;ext3&nbsp;start &nbsp;</span><br>21.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;Filesystem[4062]:&nbsp;INFO:&nbsp;Running&nbsp;start for&nbsp;/dev/sdb5&nbsp;on&nbsp;/webdata &nbsp;</span><br>22.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;kernel:&nbsp;kjournald&nbsp;starting.&nbsp;&nbsp;Commit&nbsp;interval&nbsp;5&nbsp;seconds &nbsp;</span><br>23.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;kernel:&nbsp;EXT3&nbsp;FS&nbsp;on&nbsp;sdb5,&nbsp;internal&nbsp;journal &nbsp;</span><br>24.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;kernel:&nbsp;EXT3-fs:&nbsp;mounted&nbsp; filesystem&nbsp;with&nbsp;ordered&nbsp;data&nbsp;mode. &nbsp;</span><br>25.  <span>Nov&nbsp;26&nbsp;07:54:26&nbsp;node1&nbsp;Filesystem[4059]:&nbsp;INFO:&nbsp; Success &nbsp;</span><br>26.  <span>Nov&nbsp;26&nbsp;07:54:33&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info: Local&nbsp;Resource&nbsp;acquisition&nbsp;completed.&nbsp;(none) &nbsp;</span><br>27.  <span>Nov&nbsp;26&nbsp;07:54:33&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info: local&nbsp;resource&nbsp;transition&nbsp;completed&nbsp;</span><br><br>上面这段日志是进行资源的监控和接管，主要完成haresources文件中的设置，在这里是启用集群虚拟IP和挂载磁盘分区。<br><br>此时，通过ifconfig命令查看主节点的网络配置，可以看到，主节点已经自动绑定集群IP地址，在HA集群之外的主机上通过ping命令检测集群IP地址192.168.60.200，已经处于可通状态，也就是该地址变得可用。<br><br>同时查看磁盘分区的挂载情况，共享磁盘分区/dev/sdb5已经被自动挂载。<br><br><strong>2．启动备份节点的Heartbeat</strong><br><br>启动备份节点的Heartbeat，与主节点方法一样，使用如下命令：<br><br>1.  <span><span>[root@node2&nbsp;~]#/etc/init.d/heartbeat&nbsp;start&nbsp;&nbsp;</span></span><br><br>或者执行：<br><br>1.  <span><span>[root@node2&nbsp;~]#service&nbsp;heartbeat&nbsp;start&nbsp;&nbsp;</span></span><br><br>这样就启动了备用节点的Heartbeat服务。为了让Heartbeat能在开机自动运行以及关机自动关闭，创建以下软连接：<br><br>1.  <span><span>[root@node2&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc0.d/K05heartbeat &nbsp;</span></span><br>2.  <span>[root@node2&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc3.d/S75heartbeat &nbsp;</span><br>3.  <span>[root@node2&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc5.d/S75heartbeat &nbsp;</span><br>4.  <span>[root@node2&nbsp;~]#ln&nbsp;-s&nbsp;&nbsp;/etc/init.d/heartbeat&nbsp;&nbsp;/etc/rc.d/rc6.d/K05heartbeat&nbsp;</span><br><br>备用节点的Heartbeat日志输出信息与主节点相对应，通过&quot;tail -f /var/log/messages&quot;可以看到如下输出：<br><br>1.  <span><span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Link&nbsp;node1:eth1&nbsp;up. &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Status&nbsp;update for&nbsp;node&nbsp;node1:&nbsp;status&nbsp;active &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Link&nbsp;node1:eth0&nbsp;up. &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;harc[2123]:&nbsp;info:&nbsp;Running&nbsp;/etc/ha.d/rc.d/status&nbsp;status &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Comm_now_up():&nbsp; updating&nbsp;status&nbsp;to&nbsp;active &nbsp;</span><br>6.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Local&nbsp; status&nbsp;now&nbsp;set&nbsp;to:&nbsp;&#039;active&#039; &nbsp;</span><br>7.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Starting&nbsp; child&nbsp;client&nbsp;&quot;/usr/lib/heartbeat/ipfail&quot;&nbsp;(694,694) &nbsp;</span><br>8.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;WARN:&nbsp;G _CH_dispatch_int:&nbsp;Dispatch&nbsp;function&nbsp;for&nbsp;read&nbsp;child&nbsp; took&nbsp;too&nbsp;long&nbsp;to&nbsp;execute:&nbsp;70&nbsp;ms&nbsp;(</span><span class="tag"><strong><font color="#006699">&gt;</font></strong></span><span>&nbsp;50&nbsp;ms)&nbsp;(GSource:&nbsp;0x8f62080) &nbsp;</span><br>9.  <span>Nov&nbsp;26&nbsp;07:57:15&nbsp;node2&nbsp;heartbeat:&nbsp;[2134]:&nbsp;info:&nbsp; Starting&nbsp;&quot;/usr/lib/heartbeat/ipfail&quot;&nbsp;as&nbsp;uid&nbsp;694&nbsp;&nbsp;gid&nbsp;694&nbsp;(pid&nbsp;2134)&nbsp;</span><br><br>备份节点检测到node1处于活动状态，没有可以接管的资源，因此仅仅启动了网络监听插件ipfail，监控主节点的心跳。<br><br><strong>测试Heartbeat</strong><br><br>如何才能得知HA集群是否正常工作，模拟环境测试是个不错的方法。在把Heartbeat高可用性集群放到生产环境中之前，需要做如下5个步骤的测试，从而确定HA是否正常工作。<br><br><strong>1．正常关闭和重启主节点的Heartbeat</strong><br><br>首先在主节点node1上执行&quot;service heartbeat stop&quot;正常关闭主节点的Heartbeat进程，此时通过ifconfig命令查看主节点网卡信息。正常情况下，应该可以看到主节点已经释放了集群的 服务IP地址，同时也释放了挂载的共享磁盘分区。然后查看备份节点，现在备份节点已经接管了集群的服务IP，同时也自动挂载上了共享的磁盘分区。<br><br>在这个过程中，使用ping命令对集群服务IP进行测试。可以看到，集群IP一致处于可通状态，并没有任何延时和阻塞现象，也就是说在正常关闭主节点的情况下，主备节点的切换是无缝的，HA对外提供的服务也可以不间断运行。<br><br>接着，将主节点Heartbeat正常启动。Heartbeat启动后，备份节点将自动释放集群服务IP，同时卸载共享磁盘分区，而主节点将再次接管集群服务IP和挂载共享磁盘分区。其实备份节点释放资源与主节点绑定资源是同步进行的，因而，这个过程也是一个无缝切换。<br><br><strong>2．在主节点上拔去网线</strong><br><br>拔去主节点连接公共网络的网线后，Heartbeat插件ipfail通过ping测试可以立刻检测到网络连接失败，接着自动释放资源。而就在此 时，备用节点的ipfail插件也会检测到主节点出现网络故障，在等待主节点释放资源完毕后，备用节点马上接管了集群资源，从而保证了网络服务不间断持续 运行。<br><br>同理，当主节点网络恢复正常时，由于设置了&quot;auto_failback on&quot;选项，集群资源将自动从备用节点切会主节点。<br><br>在主节点拔去网线后日志信息如下，注意日志中的斜体部分：<br><br>1.  <span><span>Nov&nbsp;26&nbsp;09:04:09&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp;Link&nbsp;node2:eth0&nbsp;dead. &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;09:04:09&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp; Link&nbsp;192.168.60.1:192.168.60.1&nbsp;dead. &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;09:04:09&nbsp;node1&nbsp;ipfail:&nbsp;[3712]:&nbsp;info:&nbsp;Status&nbsp;update:&nbsp; Node&nbsp;192.168.60.1&nbsp;now&nbsp;has&nbsp;status&nbsp;dead &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;09:04:09&nbsp;node1&nbsp;harc[4279]:&nbsp;info:&nbsp;Running&nbsp;/etc/ha.d/rc.d/status&nbsp;status &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;09:04:10&nbsp;node1&nbsp;ipfail:&nbsp;[3712]:&nbsp;info:&nbsp;NS:&nbsp;We&nbsp;are&nbsp;dead.&nbsp;:</span><span class="tag"><strong><font color="#006699">&lt;</font></strong></span><span>&nbsp;</span><br>6.  <span class="tag-name"><strong><font color="#006699">Nov</font></strong></span><span>&nbsp;26&nbsp;09:04:10&nbsp;node1&nbsp;ipfail:&nbsp;[3712]:&nbsp;info:&nbsp;Link&nbsp;Status&nbsp; update:&nbsp;Link&nbsp;node2/eth0&nbsp;now&nbsp;has&nbsp;status&nbsp;dead &nbsp;</span><br>7.  <span>&hellip;&hellip;&nbsp;中间部分省略&nbsp;&nbsp;&hellip;&hellip; &nbsp;</span><br>8.  <span>Nov&nbsp;26&nbsp;09:04:20&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp;node1&nbsp;wants&nbsp;to&nbsp;go&nbsp;standby&nbsp;[all] &nbsp;</span><br>9.  <span>Nov&nbsp;26&nbsp;09:04:20&nbsp;node1&nbsp;heartbeat:&nbsp;[3689]:&nbsp;info:&nbsp;standby:&nbsp; node2&nbsp;can&nbsp;take&nbsp;our&nbsp;all&nbsp;resources &nbsp;</span><br>10.  <span>Nov&nbsp;26&nbsp;09:04:20&nbsp;node1&nbsp;heartbeat:&nbsp;[4295]:&nbsp;info:&nbsp;give&nbsp;up&nbsp;all&nbsp; HA&nbsp;resources&nbsp;(standby). &nbsp;</span><br>11.  <span>Nov&nbsp;26&nbsp;09:04:21&nbsp;node1&nbsp;ResourceManager[4305]:&nbsp;info:&nbsp;Releasing&nbsp; resource&nbsp;group:&nbsp;node1&nbsp;192.168.60.200/24/eth0&nbsp;Filesystem::/dev/sdb5::/webdata::ext3 &nbsp;</span><br>12.  <span>Nov&nbsp;26&nbsp;09:04:21&nbsp;node1&nbsp;ResourceManager[4305]:&nbsp;info:&nbsp;Running&nbsp; /etc/ha.d/resource.d/&nbsp;Filesystem/dev/sdb5&nbsp;/webdata&nbsp;ext3&nbsp;stop &nbsp;</span><br>13.  <span>Nov&nbsp;26&nbsp;09:04:21&nbsp;node1&nbsp;Filesystem[4343]:&nbsp;INFO:&nbsp;Running&nbsp;stop&nbsp;for&nbsp;/dev/sdb5&nbsp;on&nbsp;/webdata &nbsp;</span><br>14.  <span>Nov&nbsp;26&nbsp;09:04:21&nbsp;node1&nbsp;Filesystem[4343]:&nbsp;INFO:&nbsp;Trying&nbsp;to&nbsp;unmount&nbsp;/webdata &nbsp;</span><br>15.  <span>Nov&nbsp;26&nbsp;09:04:21&nbsp;node1&nbsp;Filesystem[4343]:&nbsp;INFO:&nbsp;unmounted&nbsp;/webdata&nbsp;successfully &nbsp;</span><br>16.  <span>Nov&nbsp;26&nbsp;09:04:21&nbsp;node1&nbsp;Filesystem[4340]:&nbsp;INFO:&nbsp;&nbsp;Success &nbsp;</span><br>17.  <span>Nov&nbsp;26&nbsp;09:04:22&nbsp;node1&nbsp;ResourceManager[4305]:&nbsp;info:&nbsp;Running /etc/ha.d/resource.d/IPaddr&nbsp;192.168.60.200/24/eth0&nbsp;stop &nbsp;</span><br>18.  <span>Nov&nbsp;26&nbsp;09:04:22&nbsp;node1&nbsp;IPaddr[4428]:&nbsp;INFO:&nbsp;/sbin/ifconfig&nbsp;eth0:0&nbsp;192.168.60.200&nbsp;down &nbsp;</span><br>19.  <span>Nov&nbsp;26&nbsp;09:04:22&nbsp;node1&nbsp;avahi-daemon[1854]:&nbsp;Withdrawing&nbsp; address&nbsp;record&nbsp;for&nbsp;192.168.60.200&nbsp;on&nbsp;eth0. &nbsp;</span><br>20.  <span>Nov&nbsp;26&nbsp;09:04:22&nbsp;node1&nbsp;IPaddr[4407]:&nbsp;INFO:&nbsp;&nbsp;Success&nbsp;</span><br><br>备用节点在接管主节点资源时的日志信息如下：<br><br>1.  <span><span>Nov&nbsp;26&nbsp;09:02:58&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;Link&nbsp;node1:eth0&nbsp;dead. &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;09:02:58&nbsp;node2&nbsp;ipfail:&nbsp;[2134]:&nbsp;info:&nbsp;Link&nbsp;Status&nbsp; update:&nbsp;Link&nbsp;node1/eth0&nbsp;now&nbsp;has&nbsp;status&nbsp;dead &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;09:02:59&nbsp;node2&nbsp;ipfail:&nbsp;[2134]:&nbsp;info:&nbsp;Asking&nbsp; other&nbsp;side&nbsp;for&nbsp;ping&nbsp;node&nbsp;count. &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;09:02:59&nbsp;node2&nbsp;ipfail:&nbsp;[2134]:&nbsp;info:&nbsp;Checking&nbsp;remote&nbsp;count&nbsp;of&nbsp;ping&nbsp;nodes. &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;09:03:02&nbsp;node2&nbsp;ipfail:&nbsp;[2134]:&nbsp;info:&nbsp;Telling&nbsp;other node&nbsp;that&nbsp;we&nbsp;have&nbsp;more&nbsp;visible&nbsp;ping&nbsp;nodes. &nbsp;</span><br>6.  <span>Nov&nbsp;26&nbsp;09:03:09&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;node1&nbsp; wants&nbsp;to&nbsp;go&nbsp;standby&nbsp;[all] &nbsp;</span><br>7.  <span>Nov&nbsp;26&nbsp;09:03:10&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info:&nbsp;standby:&nbsp; acquire&nbsp;[all]&nbsp;resources&nbsp;from&nbsp;node1 &nbsp;</span><br>8.  <span>Nov&nbsp;26&nbsp;09:03:10&nbsp;node2&nbsp;heartbeat:&nbsp;[2281]:&nbsp;info:&nbsp;acquire&nbsp;all&nbsp;HA&nbsp;resources&nbsp;(standby). &nbsp;</span><br>9.  <span>Nov&nbsp;26&nbsp;09:03:10&nbsp;node2&nbsp;ResourceManager[2291]:&nbsp;info:&nbsp;Acquiring&nbsp; resource&nbsp;group:&nbsp;node1&nbsp;192.168.60.200/24/eth0&nbsp;Filesystem::/dev/sdb5::/webdata::ext3 &nbsp;</span><br>10.  <span>Nov&nbsp;26&nbsp;09:03:10&nbsp;node2&nbsp;IPaddr[2315]:&nbsp;INFO:&nbsp;&nbsp;Resource&nbsp;is&nbsp;stopped &nbsp;</span><br>11.  <span>Nov&nbsp;26&nbsp;09:03:11&nbsp;node2&nbsp;ResourceManager[2291]:&nbsp;info:&nbsp;Running /etc/ha.d/resource.d/IPaddr&nbsp;192.168.60.200/24/eth0&nbsp;start &nbsp;</span><br>12.  <span>Nov&nbsp;26&nbsp;09:03:11&nbsp;node2&nbsp;IPaddr[2393]:&nbsp;INFO:&nbsp;Using&nbsp;calculated&nbsp; netmask&nbsp;for&nbsp;192.168.60.200:&nbsp;255.255.255.0 &nbsp;</span><br>13.  <span>Nov&nbsp;26&nbsp;09:03:11&nbsp;node2&nbsp;IPaddr[2393]:&nbsp;DEBUG:&nbsp;Using&nbsp;calculated&nbsp; broadcast&nbsp;for&nbsp;192.168.60.200:&nbsp;192.168.60.255 &nbsp;</span><br>14.  <span>Nov&nbsp;26&nbsp;09:03:11&nbsp;node2&nbsp;IPaddr[2393]:&nbsp;INFO:&nbsp;eval&nbsp;/sbin/ifconfig&nbsp; eth0:0&nbsp;192.168.60.200&nbsp;netmask&nbsp;255.255.255.0&nbsp;broadcast&nbsp;192.168.60.255 &nbsp;</span><br>15.  <span>Nov&nbsp;26&nbsp;09:03:12&nbsp;node2&nbsp;avahi-daemon[1844]:&nbsp;Registering&nbsp;new&nbsp; address&nbsp;record&nbsp;for&nbsp;192.168.60.200&nbsp;on&nbsp;eth0. &nbsp;</span><br>16.  <span>Nov&nbsp;26&nbsp;09:03:12&nbsp;node2&nbsp;IPaddr[2393]:&nbsp;DEBUG:&nbsp;Sending&nbsp;Gratuitous&nbsp; Arp&nbsp;for&nbsp;192.168.60.200&nbsp;on&nbsp;eth0:0&nbsp;[eth0] &nbsp;</span><br>17.  <span>Nov&nbsp;26&nbsp;09:03:12&nbsp;node2&nbsp;IPaddr[2372]:&nbsp;INFO:&nbsp;&nbsp;Success &nbsp;</span><br>18.  <span>Nov&nbsp;26&nbsp;09:03:12&nbsp;node2&nbsp;Filesystem[2482]:&nbsp;INFO:&nbsp;&nbsp;Resource&nbsp;is&nbsp;stopped &nbsp;</span><br>19.  <span>Nov&nbsp;26&nbsp;09:03:12&nbsp;node2&nbsp;ResourceManager[2291]:&nbsp;info:&nbsp;Running /etc/ha.d/resource.d/&nbsp;Filesystem/dev/sdb5&nbsp;/webdata&nbsp;ext3&nbsp;start &nbsp;</span><br>20.  <span>Nov&nbsp;26&nbsp;09:03:13&nbsp;node2&nbsp;Filesystem[2523]:&nbsp;INFO:&nbsp;Running&nbsp;start&nbsp;for&nbsp;/dev/sdb5&nbsp;on&nbsp;/webdata &nbsp;</span><br>21.  <span>Nov&nbsp;26&nbsp;09:03:13&nbsp;node2&nbsp;kernel:&nbsp;kjournald&nbsp;starting.&nbsp;&nbsp;Commit&nbsp;interval&nbsp;5&nbsp;seconds &nbsp;</span><br>22.  <span>Nov&nbsp;26&nbsp;09:03:13&nbsp;node2&nbsp;kernel:&nbsp;EXT3&nbsp;FS&nbsp;on&nbsp;sdb5,&nbsp;internal&nbsp;journal &nbsp;</span><br>23.  <span>Nov&nbsp;26&nbsp;09:03:13&nbsp;node2&nbsp;kernel:&nbsp;EXT3-fs:&nbsp;mounted&nbsp;filesystem&nbsp;with&nbsp;ordered&nbsp;data&nbsp;mode. &nbsp;</span><br>24.  <span>Nov&nbsp;26&nbsp;09:03:13&nbsp;node2&nbsp;Filesystem[2520]:&nbsp;INFO:&nbsp;&nbsp;Success&nbsp;</span><br><br><strong>3．在主节点上拔去电源线</strong><br><br>在主节点拔去电源后，备用节点的Heartbeat进程会立刻收到主节点已经shutdown的消息。如果在集群上配置了Stonith设备，那么 备用节点将会把电源关闭或者复位到主节点。当Stonith设备完成所有操作时，备份节点才能拿到接管主节点资源的所有权，从而接管主节点的资源。<br><br>在主节点拔去电源后，备份节点有类似如下的日志输出：<br><br>1.  <span><span>Nov&nbsp;26&nbsp;09:24:54&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info: Received&nbsp;shutdown&nbsp;notice&nbsp;from&nbsp;&#039;node1&#039;. &nbsp;</span></span><br>2.  <span>Nov&nbsp;26&nbsp;09:24:54&nbsp;node2&nbsp;heartbeat:&nbsp;[2110]:&nbsp;info: Resources&nbsp;being&nbsp;acquired&nbsp;from&nbsp;node1. &nbsp;</span><br>3.  <span>Nov&nbsp;26&nbsp;09:24:54&nbsp;node2&nbsp;heartbeat:&nbsp;[2712]:&nbsp;info:&nbsp; acquire&nbsp;local&nbsp;HA&nbsp;resources&nbsp;(standby). &nbsp;</span><br>4.  <span>Nov&nbsp;26&nbsp;09:24:55&nbsp;node2&nbsp;ResourceManager[2762]:&nbsp; info:&nbsp;Running&nbsp;/etc/ha.d/resource.d/IPaddr&nbsp;192.168.60.200/24/eth0&nbsp;start &nbsp;</span><br>5.  <span>Nov&nbsp;26&nbsp;09:24:57&nbsp;node2&nbsp;ResourceManager[2762]:&nbsp; info:&nbsp;Running&nbsp;/etc/ha.d/resource.d/&nbsp;Filesystem&nbsp;/dev/sdb5&nbsp;/webdata&nbsp;ext3&nbsp;start&nbsp;</span><br><br><strong>4．切断主节点的所有网络连接</strong><br><br>在主节点上断开心跳线后，主备节点都会在日志中输出&quot;eth1 dead&quot;的信息，但是不会引起节点间的资源切换。如果再次拔掉主节点连接公共网络的网线，就会发生主备节点资源切换，资源从主节点转移到备用节点。此 时，连上主节点的心跳线，观察系统日志，可以看到，备用节点的Heartbeat进程将会重新启动，进而再次控制集群资源。最后，连上主节点的对外网线， 集群资源再次从备用节点转移到主节点。这就是整个切换过程。<br><br><strong>5．在主节点上非正常关闭Heartbeat守护进程</strong><br><br>在主节点上可通过&quot;killall -9 heartbeat&quot;命令关闭Heartbeat进程。由于是非法关闭Heartbeat进程，因此Heartbeat所控制的资源并没有释放。备份节点 在很短一段时间没有收到主节点的响应后，就会认为主节点出现故障，进而接管主节点资源。在这种情况下，就出现了资源争用情况，两个节点都占用一个资源，造 成数据冲突。针对这个情况，可以通过Linux提供的内核监控模块watchdog来解决这个问题，将watchdog集成到Heartbeat中。如果 Heartbeat异常终止，或者系统出现故障，watchdog都会自动重启系统，从而释放集群资源，避免了数据冲突的发生。<br><br>本章节我们没有配置watchdog到集群中，如果配置了watchdog，在执行&quot;killall -9 heartbeat&quot;时，会在/var/log/messages中看到如下信息：<br><br>1.  <span><span>Softdog:&nbsp;WDT&nbsp;device&nbsp;closed&nbsp;unexpectedly.&nbsp;WDT&nbsp;will&nbsp;not&nbsp;stop!&nbsp;</span></span><br><br>这个错误告诉我们，系统出现问题，将重新启动。<br><br>&nbsp;<br><br>&nbsp;<font color="#000099"><em>*原文地址</em></font> <a href="http://book.51cto.com/art/200912/168034.htm" target="_blank" rel="external">http://book.51cto.com/art/200912/168034.htm </a><br><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2011/08/09/'[转载]Heartbeat详解'/">[转载]Heartbeat详解 </a></p>
        <p><span>文章作者:</span><a href="/" title="访问 elain 的个人博客">elain</a></p>
        <p><span>发布时间:</span>2011年08月09日 - 11时08分</p>
        <p><span>最后更新:</span>2016年02月02日 - 14时18分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2011/08/09/'[转载]Heartbeat详解'/" title="[转载]Heartbeat详解 ">http://www.elain.org/2011/08/09/&#39;[转载]Heartbeat详解&#39;/</a>
            <span class="copy-path" data-clipboard-text="原文: http://www.elain.org/2011/08/09/&#39;[转载]Heartbeat详解&#39;/　　作者: elain" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2011/08/09/分享ubuntu文档汇总/">
                    分享Ubuntu文档汇总
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2011/08/08/ganglia监控的搭建部署/">
                    Ganglia监控的搭建部署
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>




    <div class="share">
    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
    <a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
    <a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
    </div>
    <script>
        window._bd_share_config={
            "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
</div>



    
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="2011/08/09/&#39;[转载]Heartbeat详解&#39;/" data-title="[转载]Heartbeat详解 " data-url="http://www.elain.org/2011/08/09/&#39;[转载]Heartbeat详解&#39;/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"elain"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2011/08/09/分享ubuntu文档汇总/" title="上一篇: 分享Ubuntu文档汇总">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2011/08/08/ganglia监控的搭建部署/" title="下一篇: Ganglia监控的搭建部署">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/02/01/使用rsyslog来收集常用日志/">使用Rsyslog来收集常用日志</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/27/Rsyslog的使用/">Rsyslog的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/17/EFK日志收集丢失率测试报告/">EFK日志收集丢失率测试报告</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/16/给EFK日志系统添加kafka队列中遇到的time问题解决/">给EFK日志系统添加kafka队列中遇到的time问题解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/01/给kibana4中配置中国地图(添加最新版4.3.1修改方法)/">给kibana4中配置中国地图(添加最新版4.3.1修改方法)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/31/Elasticsearch免费认证插件Search-guard的部署安装及策略配置/">Elasticsearch 免费认证插件Search-Guard的部署安装及策略配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/15/多业务复用同组WEB通过独立upstream来敏捷运维/">多业务复用同组WEB通过独立upstream来敏捷运维</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/20/'[转]程序员可以在周末做的8件事'/">[转]程序员可以在周末做的8件事</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/08/17/'[转]VIM命令小抄，很不错'/">[转]VIM命令小抄，很不错</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/06/25/puppet管理之用户与SSH信任关系管理/">puppet管理之用户与SSH信任关系管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/05/30/puppet常用模块/">Puppet常用模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/05/29/在puppet使用中针对域名形式主机名取$hostname的问题/">在Puppet使用中针对域名形式主机名取$hostname的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/04/18/'[转]自己活，也让别人活'/">[转]自己活，也让别人活</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/03/26/'[转]40岁后才明白的道理:人一生奋斗余地很有限'/">[转]40岁后才明白的道理:人一生奋斗余地很有限</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/03/26/'[转]世界上最健康的作息时间表'/">[转]世界上最健康的作息时间表</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/03/26/'[转]30岁以前不要去在乎的30件事'/">[转]30岁以前不要去在乎的30件事</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/12/18/'[转]2012年LinuxJournal读者选择奖结果公布'/">[转]2012年Linux Journal读者选择奖结果公布</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/12/06/'[转]创业公司老板管理常识'/">[转]创业公司老板管理常识</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/11/28/'[转]如何摆脱低智商的社会，让自己脱颖而出？'/">[转]如何摆脱低智商的社会，让自己脱颖而出？</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/11/12/'[转]为什么IT人难以拿高薪'/">[转]为什么IT人难以拿高薪</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/11/12/[转]IT职业生涯规划–职涯路/">[转]IT职业生涯规划–职涯路</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/10/22/[转]简明Vim练级攻略/">[转]简明Vim练级攻略</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/08/25/修改.bashrc文件错误导致系统大部分命令失效的解决方法/">修改.Bashrc文件错误导致系统大部分命令失效的解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/08/11/Puppet的使用与管理ppt分享/">Puppet的使用与管理 Ppt分享</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/07/31/使用openssh的新特性构建chroot环境/">使用Openssh的新特性构建chroot环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/06/27/闰秒BUG可能导致Linux服务器重启/">闰秒BUG可能导致Linux服务器重启</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/06/16/'[转]不同技术团队的配合问题及DevOps'/">[转]不同技术团队的配合问题及DevOps</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/06/06/'[新闻]IPv6今日正式上线中国支持IPv6网站占比达65%'/">[新闻]IPv6今日正式上线中国支持IPv6网站占比达65%</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/05/19/'ubuntu软件---RabbitVCS/">Ubuntu软件---RabbitVCS : TortoiseSVN 的替代者</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/04/26/ubuntu12.04正式版官方发布/">Ubuntu12.04正式版官方发布</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/04/24/'[转]我在Facebook的十点经验分享'/">[转]我在Facebook的十点经验分享</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/03/29/批量修改远程主机root密码脚本/">批量修改远程主机Root密码脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/03/23/'[转]如何学习技术？---献给有志之士'/">[转]如何学习技术？ ---献给有志之士</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/03/21/ubuntu游戏推荐-AlienArena-7.53/">Ubuntu游戏推荐-Alien Arena-7.53</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/03/17/[转]让你的Ubuntu10.10装扮成MacOSX风格/">[转]让你的Ubuntu10.10装扮成MacOSX风格</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/03/05/'[转]logrotate工具的使用'/">[转]Logrotate工具的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/02/27/'[转]一声叹息：两台服务器是为失败者准备的'/">[转]一声叹息：两台服务器是为失败者准备的</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/02/13/帮朋友招聘运维工程师（小米科技）/">帮朋友招聘运维工程师（小米科技）</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/02/03/'[PHP又暴重大漏洞]多语言拒绝服务漏洞事件预警'/">[PHP又暴重大漏洞]多语言拒绝服务漏洞事件预警</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/30/MongoDB实战系列之六：mongodb的高可用集群设计实战/">MongoDB实战系列之六：mongodb的高可用集群设计实战</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/17/MongoDB实战系列之五：mongodb的分片配置/">MongoDB实战系列之五：mongodb的分片配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/13/推荐三款nagios客户端，覆盖所有系统平台/">推荐三款Nagios客户端，覆盖所有系统平台</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/13/MongoDB实战系列之四：mongodb副本集部署/">MongoDB实战系列之四：mongodb副本集部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/12/'[新闻]PHP5.3.9正式版发布！'/">[新闻]PHP 5.3.9正式版发布！</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/08/MongoDB实战系列之三：MongoDB的主从部署/">MongoDB实战系列之三：MongoDB的主从部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2012/01/01/MongoDB实战系列之二：MongoDB的常用操作/">MongoDB实战系列之二：MongoDB的常用操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/12/31/MongoDB实战系列之一：MongoDB安装部署/">MongoDB实战系列之一：MongoDB安装部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/12/23/'[新闻]IT网站被黑引数据恐慌5000万用户信息外泄'/">[新闻]IT网站被黑引数据恐慌 5000万用户信息外泄</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/12/04/'[转]MySQL出错代码列表'/">[转]MySQL出错代码列表</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/12/03/'[新闻]淘宝Web服务器Tengine正式开源'/">[新闻]淘宝Web服务器Tengine正式开源</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/29/'[跟我学中小企业架构部署]之八：备份服务器部署'/">[跟我学中小企业架构部署]之八：备份服务器部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/26/'[转]每天两分钟远离电脑病'/">[转]每天两分钟 远离电脑病</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/25/监控WEB页面不正常报警脚本/">监控WEB页面不正常报警脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/24/'[转]网站页面性能优化的34条黄金守则'/">[转]网站页面性能优化的 34条黄金守则</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/21/'[跟我学中小企业架构部署]之七：监控系统cacti部署'/">[跟我学中小企业架构部署]之七：监控系统Cacti部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/09/'[转]keepalived.conf文件详解'/">[转]keepalived.conf 文件详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/07/'[跟我学中小企业架构部署]之六：监控系统nagios部署'/">[跟我学中小企业架构部署]之六：监控系统Nagios部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/05/无聊中安装的MACOS截图欣赏/">无聊中安装的MAC OS截图欣赏</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/04/'[转]浮夸'/">[转]浮夸</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/11/04/Redis的部署使用文档/">Redis的部署使用文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/29/用Piranha来实现WEB的负载均衡/">用Piranha来实现WEB的负载均衡</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/28/SSH另类安全加固/">SSH另类安全加固</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/25/'[跟我学中小企业架构部署]之五：WEB服务器LNMP部署'/">[跟我学中小企业架构部署]之五：WEB服务器LNMP部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/19/'[转载]kickstart配置文件详解'/">[转载]Kickstart配置文件详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/18/'[跟我学中小企业架构部署]之四：WEB服务器LAMP部署'/">[跟我学中小企业架构部署]之四：WEB服务器LAMP部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/14/'[跟我学中小企业架构部署]之三：数据库多实例部署'/">[跟我学中小企业架构部署]之三：数据库多实例部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/13/Ubuntu 11.10 正式版抢先体验(附下载地址)/">Ubuntu 11.10 正式版抢先体验(附下载地址)</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/11/CentOS下nagios报警飞信部署四步走/">CentOS下nagios报警飞信部署四步走</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/11/'[跟我学中小企业架构部署]之二：负载均衡部署'/">[跟我学中小企业架构部署]之二：负载均衡部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/09/'[跟我学中小企业架构部署]之一：整体架构设计'/">[跟我学中小企业架构部署]之一：整体架构设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/06/奥巴马总统对乔布斯的悼念--向伟大的SteveJobs致敬/">奥巴马总统对乔布斯的悼念--向伟大的Steve Jobs致敬</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/10/04/成功中国网即将重新上线！！！/">成功中国网即将重新上线！！！</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/27/'[转]Facebook背后的软件'/">[转]Facebook背后的软件</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/26/Hadoop系列之一：hadoop部署安装/">Hadoop系列之一：hadoop部署安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/20/LVS+Heartbeat安装部署文档/">LVS+Heartbeat安装部署文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/14/'[转载]轻松吧！重要人生启示'/">[转载]轻松吧！重要人生启示 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/13/phpmyadmin-MYSQL管理工具安装/">Phpmyadmin-MYSQL管理工具安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/08/分享神作《甩饼歌》/">分享神作《甩饼歌》</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/07/Memcached安装部署/">Memcached安装部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/05/SVN服务端数据定时备份脚本/">SVN服务端数据定时备份脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/09/02/多服务器访问日志合并脚本/">多服务器访问日志合并脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/29/'[转]袁萌：我国普及Linux的回顾与展望'/">[转]袁萌：我国普及Linux的回顾与展望</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/29/LEMP部署安装for RHEL AS4.6/">LEMP部署安装for RHEL AS4.6</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/25/'[转]快讯：Apache全系爆拒绝服务漏洞'/">[转]快讯：Apache 全系爆拒绝服务漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/25/apache+tomcat安装配置/">Apache+tomcat安装配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/18/分布式文件系统MooseFS的部署安装/">分布式文件系统MooseFS的部署安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/18/awstats日志分析工具部署/">Awstats日志分析工具部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/17/分享两个超级震撼的视频/">分享两个超级震撼的视频</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/16/检测MYSQL不同步发邮件通知的脚本/">检测MYSQL不同步发邮件通知的脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/16/PHP扩展缓存加速安装/">PHP扩展缓存加速安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/16/飞信forLinux安装/">飞信forLinux安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/15/'[客户端]批量部署监控客户端，多机分发'/">[客户端]批量部署监控客户端，多机分发 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/11/ubuntu运行wineQQ(比较完美)/">Ubuntu运行wine QQ(比较完美)</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/11/CentOS5.5下升级内核到2.6.38/">CentOS5.5下升级内核到2.6.38</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/09/分享ubuntu文档汇总/">分享Ubuntu文档汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/09/'[转载]Heartbeat详解'/">[转载]Heartbeat详解 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/08/ganglia监控的搭建部署/">Ganglia监控的搭建部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/08/ubuntu下使用gSTM+Firefox实现翻墙/">ubuntu下使用gSTM+Firefox实现翻墙</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/08/WINDOWS下使用SecureCRT+FireFox代理实现翻墙/">WINDOWS下使用SecureCRT+FireFox代理实现翻墙</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/07/earth-song-by-michael-jackson/">Earth Song by Michael Jackson</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/07/仅有内网IP的IDC的机器如何能够连到外网/">仅有内网IP的IDC的机器如何能够连到外网</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/05/you-are-not-alone-by-michael-jackson/">You Are Not Alone by Michael Jackson</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/04/screen命令的使用/">Screen命令的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/04/PHP安装xhprof扩展/">PHP安装xhprof扩展</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/04/GraphicsMagick扩展配置安装/">GraphicsMagick扩展配置安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/03/实战生产环境下使用parted给大于2T以上硬盘分区/">实战生产环境下使用parted给大于2T以上硬盘分区</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/01/编写脚本时以年月日为目录时值得注意的地方/">编写脚本时以年月日为目录时值得注意的地方</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/01/ubuntu面板恢复方法/">Ubuntu面板恢复方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/08/01/ubuntu下使用windows字体/">Ubuntu下使用windows字体</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/29/检查NGINX配置文件修改后自动reload脚本/">检查NGINX配置文件修改后自动reload脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/29/'[推荐]LINUX运维工程师学习资料[elain整理]'/">[推荐]LINUX运维工程师学习资料[elain整理] </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/28/pptpd安装部署文档/">Pptpd安装部署文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/26/Varnish安装部署文档/">Varnish安装部署文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/25/SVN在另类环境中实现自动提交的方法/">SVN在另类环境中实现自动提交的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/24/'[转载]职场人如何让老板舍不得你'/">[转载]职场人如何让老板舍不得你 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/23/ssh无密码登录验证技术/">Ssh 无密码登录验证技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/22/'实现linux作为server时与windows间的数据同步'/">实现Linux作为server时与windows间的数据同步 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/22/监控性能方面命令大总结/">监控性能方面命令大总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/22/'CentOS5.5下SVN部署文档'/">CentOS5.5下SVN部署文档 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/22/ubuntu下yakuake使用设置技巧/">Ubuntu下yakuake使用设置技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/21/CentOs5.4设置DVD为本地yum源/">CentOs5.4设置DVD为本地yum源</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/21/网络传输边传输边压缩方法/">网络传输边传输边压缩方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/21/'日志归总脚本部署思路'/">日志归总脚本部署思路 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/07/NGINX多域名日志切割备份脚本/">NGINX 多域名日志切割备份脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/07/01/nginx.conf文件详解及调优/">nginx.conf文件详解及调优</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/06/17/http错误代码大全/">Http错误代码大全</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/06/13/'[转]Nginx发现重大漏洞'/">[转]Nginx发现重大漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/06/01/ubuntu下禁用笔记本触摸板方法/">Ubuntu下禁用笔记本触摸板方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/05/27/屏蔽优酷烦人的广告方法/">屏蔽优酷烦人的广告方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/05/14/ubuntu11.04的侧边栏消失的解决方法！/">ubuntu11.04的侧边栏消失的解决方法！</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/05/10/'[转]shell程序设计小知识'/">[转]Shell程序设计小知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/05/09/'ubuntu必备软件精选[elain推荐]更新20111020'/">Ubuntu必备软件精选[elain推荐]更新20111020</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/05/09/mysql常用操作命令/">Mysql常用操作命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/04/22/查看各软件配置参数/">查看各软件配置参数</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/04/18/'[转]查看Apache并发请求数及其TCP连接状态故障排除'/">[转]查看Apache并发请求数及其TCP连接状态故障排除</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/04/14/内网邮件服务器测试外网收信/">内网邮件服务器测试外网收信</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/04/02/mysql常用引擎MyISAM和innodb的几点简单特性/">Mysql 常用引擎MyISAM和innodb的几点简单特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/04/02/gnomemplayer乱码解决/">Gnome Mplayer乱码解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/04/02/ubuntu里vbox里不能使用USB的解决方法/">ubuntu里vbox里不能使用USB的解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/24/thunderbird导入通讯录乱码问题解决/">Thunderbird 导入通讯录乱码问题解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/23/献给正在为未来打拼的人/">献给正在为未来打拼的人</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/22/vsftpd服务器虚拟用户配置/">Vsftpd服务器虚拟用户配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/20/'[转]Shell中有特殊含义的字符'/">[转]Shell中有特殊含义的字符 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/20/分享elain.org数据备份脚本/">分享elain.org 数据备份脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/18/推荐一款在UBUNTU下使用的编辑器/">推荐一款在UBUNTU下使用的编辑器</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/18/'汉化thunderbird英文版及最小化到托盘的设置方法'/">汉化Thunderbird英文版及最小化到托盘的设置方法 </a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/16/'UBUNTU完美运行TM,RTX,MSOffice,迅雷'/">UBUNTU完美运行TM,RTX,MSOffice,迅雷</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/14/监控性能方面常用系统命令总结/">监控性能方面常用系统命令总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/14/让YUM只安装64位的RPM包设置方法/">让YUM只安装64位的RPM包设置方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/14/vim的一般使用技巧/">Vim的一般使用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/14/VIM颜色设置/">VIM颜色设置</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/14/TOP命令详解/">TOP 命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/08/'[varnish]Varnish安装部署'/">[varnish]Varnish安装部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/08/'[MYSQL]mysql优化'/">[MYSQL]mysql优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/08/LINUX下的查找命令-find命令详解/">LINUX下的查找命令-Find命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/08/ApacheHTTPServer与Tomcat的三种连接方式介绍/">ApacheHTTPServer与Tomcat的三种连接方式介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/08/'[MYSQL]Mysql数据库丢失root密码恢复'/">[MYSQL]Mysql 数据库丢失Root密码恢复</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/06/apache两种工作模式详解/">Apache两种工作模式详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/06/Linux系统服务详解/">Linux系统服务详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/06/Linux配置文件系统路径/">Linux配置文件系统路径</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/06/snort规则编写/">Snort 规则编写</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/05/Linux命令大总结（哭泣之剑学习时的笔记）/">Linux命令大总结（哭泣之剑学习时的笔记）</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/05/LINUX三个必背的文件/">LINUX三个必背的文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/05/打造LINUX系统安全/">打造LINUX系统安全</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/05/RHEL利用 CentOS更新 yum源/">RHEL利用 CentOS更新 Yum源</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/04/ubuntu面板恢复命令/">Ubuntu面板恢复命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/04/showslow性能测试平台搭建/">Showslow 性能测试平台搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/04/arping命令详解/">Arping命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/04/PXE+cobbler+kickstart全自动无人值守网络安装系统/">PXE+cobbler+kickstart全自动无人值守网络安装系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/03/iostat命令详解/">Iostat命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/03/vmstat命令详解/">Vmstat命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/03/mpstat命令详解/">Mpstat命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/03/sar命令详解/">Sar命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/'Linux主机名颜色设置,ps1设置,然linux有颜色'/">Linux主机名颜色设置,ps1设置,然linux有颜色</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/'Linux中变量$#,$@,$0,$1,$2的含义'/">Linux中变量$#,$@,$0,$1,$2的含义</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/解析选项getopts的用法及例子/">解析选项Getopts的用法及例子</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/Linux批量生成生成帐户脚本/">Linux批量生成生成帐户脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/tomcat多实例配置/">Tomcat 多实例配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/rsync命令详解/">Rsync命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/让gedit自动识别文件编码/">让Gedit自动识别文件编码</a></li><li class="post-list-item"><a class="post-list-link" href="/2011/03/02/IT人士十大不良饮食习惯及改进建议/">IT人士十大不良饮食习惯及改进建议</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 elain
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <style>
        body {
          background: lightgray;
        }
        #container .left-col {
          background: white;
        }
        .article-inner {
          background: white;
          margin-bottom: 1em;
        }
        .post-nav-button {
          background: #ececec;
        }
        #header .header-nav .social #GitHub {
          background-color: #bfd3ec;
        }
        #post-nav-button a {
          background: rgba(215, 216, 215, .2);
        }
        .post-list {
          background: white;
        }
    </style>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>